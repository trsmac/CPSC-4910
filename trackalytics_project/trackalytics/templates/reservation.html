{% extends 'base.html' %}
{% load static %}

{% block title %}Campground Reservations{% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/reservation.css' %}">
<link rel="stylesheet" href="{% static 'css/utilities.css' %}">
{% endblock %}

{% block content %}
<div class="mb-6">
  <h1 class="text-2xl font-bold text-gray-800">Reservation Overview</h1>
</div>

<div class="equipment-form-wrapper flex flex-col md:flex-row gap-6">
  <!-- Equipment Card -->
  <div class="equipment-selection flex-1 space-y-4">
    <label class="equipment-card block cursor-pointer hover:shadow transition">
      <img src="{% static 'images/tent.jpg' %}" alt="Tent" class="w-full h-32 object-cover rounded mb-2">
      <h3 class="text-lg font-semibold">Tent</h3>
      <p class="text-sm text-gray-600">Standard camping tent</p>
      <div class="checkbox-container mt-2 flex items-center gap-2">
        <input type="radio" name="equipment" value="Tent" id="tent-radio">
        <label for="tent-radio" class="text-sm">Select for reservation</label>
      </div>
    </label>
  </div>

  <!-- Reservation Form -->
  <div class="reservation-section flex-1">
    <button id="view-reservations-btn" class="btn btn-primary mb-4">View Current Reservations</button>

    <div class="reservation-form-card p-6 bg-white rounded shadow">
      <h2 class="text-xl font-semibold mb-4">Reservation Form</h2>
      <form id="reservation-form" method="post" action="{% url 'trackalytics:reservation' %}" class="space-y-4">
        {% csrf_token %}
        <input type="text" name="customer_name" placeholder="Customer Name" required class="input">
        <input type="tel" name="customer_phone" placeholder="Phone Number" required class="input">
        <input type="email" name="customer_email" placeholder="Email" required class="input">
        <input type="number" name="campsite_number" placeholder="Campsite Number (1–10)" min="1" max="10" required class="input">
        <input type="number" name="quantity" placeholder="Quantity" min="1" max="5" required class="input">
        <button type="submit" class="btn btn-primary w-full">Reserve Equipment</button>
      </form>
      <p id="campsite-warning" class="text-red-600 text-sm mt-2"></p>
    </div>
  </div>
</div>

<!-- Modal -->
<div id="reservation-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 z-50">
  <div class="modal-content bg-white p-6 rounded max-w-5xl mx-auto mt-20 relative">
    <span id="close-modal" class="close-btn absolute top-4 right-6 text-xl cursor-pointer">&times;</span>
    <h2 class="text-xl font-semibold mb-4">Current Reservations</h2>

    <div class="filter-sort-wrapper flex flex-wrap gap-4 mb-4">
      <input type="text" id="filter-input" placeholder="Search by name or item..." class="input flex-1">
      <select id="sort-select" class="input">
        <option value="">Sort by</option>
        <option value="name-asc">Name (A → Z)</option>
        <option value="name-desc">Name (Z → A)</option>
        <option value="item-asc">Item (A → Z)</option>
        <option value="item-desc">Item (Z → A)</option>
      </select>
    </div>

    <table id="reservations-table" class="min-w-full border text-sm">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-4 py-2 text-left">Item</th>
          <th>Name</th>
          <th>Phone</th>
          <th>Email</th>
          <th>Campsite #</th>
          <th>Quantity</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        {% for reservation in reservations %}
        <tr class="border-t">
          <td class="px-4 py-2">{{ reservation.item }}</td>
          <td>{{ reservation.name }}</td>
          <td>{{ reservation.phone }}</td>
          <td>{{ reservation.email }}</td>
          <td>{{ reservation.campsite }}</td>
          <td>{{ reservation.quantity }}</td>
          <td>
            <select data-id="{{ reservation.id }}" class="input text-sm">
              <option value="Checked Out" {% if reservation.status == 'Checked Out' %}selected{% endif %}>Checked Out</option>
              <option value="Returned" {% if reservation.status == 'Returned' %}selected{% endif %}>Returned</option>
              <option value="Missing" {% if reservation.status == 'Missing' %}selected{% endif %}>Missing</option>
            </select>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="text-right mt-4">
      <button id="save-reservation-status" class="btn btn-primary">Save Changes</button>
    </div>
  </div>
</div>
{% endblock %}

{% block js %}
<script src="{% static 'js/reservation.js' %}"></script>
{% endblock %}
